!function(t){function e(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return t[r].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var n={};return e.m=t,e.c=n,e.p="/",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function a(t){var e={camera:{point:u.default.new(0,1.8,10),fieldOfView:45,direction:u.default.new(0,3,0)},lights:[u.default.new(-30,-10,20)],objects:[new o.Sphere({center:u.default.new(0,3.5,-3),radius:3,color:u.default.new(155,200,155),material:{specular:.2,lambert:.7,ambient:.1}}),new o.Sphere({center:u.default.new(3.5*Math.sin(.1*t),2,-3+3.5*Math.cos(.1*t)),radius:.2,color:u.default.new(155,155,155),material:{specular:.1,lambert:.9,ambient:0}}),new o.Sphere({center:u.default.new(4*Math.sin(.2*t),3,-3+4*Math.cos(.2*t)),radius:.1,color:u.default.new(255,255,255),material:{specular:.2,lambert:.7,ambient:.1}})]};return e}var i=n(1),u=r(i),o=n(3),l=n(5),c=r(l),f=document.getElementById("canvas"),d=320,s=240;f.width=d,f.height=s,f.style.cssText="width:"+2*d+"px;height:"+2*s+"px";var h=new c.default(f,a,{enableSampling:!1});h.tick(),document.getElementById("play").onclick=h.play.bind(h),document.getElementById("stop").onclick=h.stop.bind(h)},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(6),i=r(a);e.default=i.default},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(e,r){n(this,t),this.color=e,this.material=r}return r(t,[{key:"calculateIntersection",value:function(){}},{key:"calculateNormal",value:function(){}}]),t}();e.default=a},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Sphere=void 0;var a=n(4),i=r(a);e.Sphere=i.default},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=n(2),c=r(l),f=n(1),d=r(f),s=function(t){function e(t){var n=t.center,r=t.radius,u=t.color,o=t.material;a(this,e);var l=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,u,o));return l.center=n,l.radius=r,l}return u(e,t),o(e,[{key:"calculateIntersection",value:function(t){var e=d.default.sub(this.center,t.origin),n=d.default.dot(e,t.direction),r=d.default.dot(e,e),a=this.radius*this.radius-r+n*n;if(!(a<0))return n-Math.sqrt(a)}},{key:"calculateNormal",value:function(t){return d.default.normalize(d.default.sub(t,this.center))}}]),e}(c.default);e.default=s},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){var n=[],r=!0,a=!1,i=void 0;try{for(var u,o=t[Symbol.iterator]();!(r=(u=o.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){a=!0,i=t}finally{try{!r&&o.return&&o.return()}finally{if(a)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(1),l=r(o),c=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.traceDepthLimit,u=void 0===i?3:i,o=r.enableSampling,l=void 0!==o&&o,c=r.numSamples,f=void 0===c?9:c;a(this,t);var d=e.width,s=e.height;this.canvas=e,this.context=e.getContext("2d"),this.data=this.context.getImageData(0,0,d,s),this.generateScene=n,this.traceDepthLimit=u,this.enableSampling=l,this.numSamples=f,this.isPlaying=!1,this.time=1}return u(t,[{key:"render",value:function(t){for(var e=t.camera,n=this.canvas,r=n.width,a=n.height,i=this.data,u=l.default.normalize(l.default.sub(e.direction,e.point)),o=l.default.normalize(l.default.cross(u,l.default.UP)),c=l.default.normalize(l.default.cross(o,u)),f=Math.PI*(e.fieldOfView/2)/180,d=a/r,s=Math.tan(f),h=d*s,y=2*s,m=2*h,v=y/(r-1),p=m/(a-1),b={origin:e.point,direction:l.default.new()},g=0;g<r;g++)for(var x=0;x<a;x++){var z=l.default.copy(l.default.ZERO);if(this.enableSampling){for(var w=Math.sqrt(this.numSamples),_=0;_<w;_++)for(var M=0;M<w;M++){var O=v*(g-s+(M+Math.random())/w)-s,S=p*(x-h+(_+Math.random())/w)-h,k=l.default.mult(o,O),P=l.default.mult(c,S);b.direction=l.default.normalize(l.default.add3(k,P,u)),z=l.default.add(z,this.trace(b,t,0))}z=l.default.div(z,this.numSamples)}else{var j=v*(g-s)-s,E=p*(x-h)-h,I=l.default.mult(o,j),T=l.default.mult(c,E);b.direction=l.default.normalize(l.default.add3(I,T,u)),z=this.trace(b,t,0)}var q=4*g+x*r*4;i.data[q+0]=z.x,i.data[q+1]=z.y,i.data[q+2]=z.z,i.data[q+3]=255}this.context.putImageData(i,0,0)}},{key:"trace",value:function(t,e,n){if(!(n>this.traceDepthLimit)){var r=this.intersectScene(t,e),a=i(r,2),u=a[0],o=a[1];if(u===1/0)return l.default.copy(l.default.WHITE);var c=l.default.add(l.default.mult(t.direction,u),t.origin);return this.surface(t,e,o,c,o.calculateNormal(c),n)}}},{key:"intersectScene",value:function(t,e){return e.objects.reduce(function(e,n){var r=n.calculateIntersection(t);return void 0!==r&&r<e[0]?[r,n]:e},[1/0,null])}},{key:"surface",value:function(t,e,n,r,a,i){var u=l.default.copy(l.default.ZERO),o=0;if(n.material.lambert)for(var c=0;c<e.lights.length;c++){var f=e.lights[c];if(this.isLightVisible(r,e,f)){var d=l.default.dot(l.default.normalize(l.default.sub(f,r)),a);d>0&&(o+=d)}}if(n.material.specular){var s={origin:r,direction:l.default.reflectThrough(t.direction,a)},h=this.trace(s,e,i+1);h&&(u=l.default.add(u,l.default.mult(h,n.material.specular)))}return o=Math.min(1,o),u=l.default.add(u,l.default.mult(n.color,o*n.material.lambert)),u=l.default.add(u,l.default.mult(n.color,n.material.ambient))}},{key:"isLightVisible",value:function(t,e,n){var r={origin:t,direction:l.default.normalize(l.default.sub(t,n))},a=this.intersectScene(r,e),u=i(a,1),o=u[0];return o>-.005}},{key:"tick",value:function(){var t=this.generateScene(this.time);this.time++,this.render(t),this.isPlaying&&requestAnimationFrame(this.tick.bind(this))}},{key:"play",value:function(){this.isPlaying||(this.isPlaying=!0,requestAnimationFrame(this.tick.bind(this)))}},{key:"stop",value:function(){this.isPlaying=!1}}]),t}();e.default=c},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={};n.UP={x:0,y:1,z:0},n.ZERO={x:0,y:0,z:0},n.WHITE={x:255,y:255,z:255},n.new=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{x:t,y:e,z:n}},n.copy=function(t){return{x:t.x,y:t.y,z:t.z}},n.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},n.cross=function(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}},n.mult=function(t,e){return{x:t.x*e,y:t.y*e,z:t.z*e}},n.div=function(t,e){return{x:t.x/e,y:t.y/e,z:t.z/e}},n.normalize=function(t){var e=n.mag(t);return 0===e?t:n.div(t,e)},n.add=function(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}},n.add3=function(t,e,n){return{x:t.x+e.x+n.x,y:t.y+e.y+n.y,z:t.z+e.z+n.z}},n.sub=function(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}},n.mag=function(t){return Math.sqrt(n.dot(t,t))},n.angleBetween=function(t,e){return Math.acos(n.dot(t,e)/(n.mag(t)*n.mag(e)))},n.reflectThrough=function(t,e){var r=n.mult(e,n.dot(t,e));return n.sub(n.mult(r,2),t)},n.dist=function(t,e){var r=n.sub(e,t);return n.mag(r)},n.equal=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z},n.lerp=function(t,e,n){return{x:t.x+(e.x-t.x)*n||0,y:t.y+(e.y-t.y)*n||0,z:t.z+(e.z-t.z)*n||0}},n.setMag=function(t,e){return n.mult(n.normalize(t),e)},n.limit=function(t,e){var r=n.dot(t,t);return r>e*e?n.setMag(t,e):t},n.heading=function(t){return Math.atan2(t.y,t.x)},n.rotate=function(t,e){var r=n.heading(t)+e,a=n.mag(t);return{x:Math.cos(r)*a,y:Math.sin(r)*a,z:t.z}},n.toString=function(t){return"["+t.x+", "+t.y+", "+t.z+"]"},n.toArray=function(t){return[t.x,t.y,t.z]},e.default=n}]);
//# sourceMappingURL=bundle.js.map