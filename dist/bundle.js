!function(t){function e(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var r={};return e.m=t,e.c=r,e.p="/",e(0)}([function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){var e={camera:{point:{x:0,y:1.8,z:10},fieldOfView:45,direction:{x:0,y:3,z:0}},lights:[{x:-30,y:-10,z:20}],objects:[{type:"sphere",center:{x:0,y:3.5,z:-3},radius:3,color:{x:155,y:200,z:155},material:{specular:.2,lambert:.7,ambient:.1}},{type:"sphere",center:{x:3.5*Math.sin(.1*t),y:2,z:-3+3.5*Math.cos(.1*t)},radius:.2,color:{x:155,y:155,z:155},material:{specular:.1,lambert:.9,ambient:0}},{type:"sphere",center:{x:4*Math.sin(.2*t),y:3,z:-3+4*Math.cos(.2*t)},radius:.1,color:{x:255,y:255,z:255},material:{specular:.2,lambert:.7,ambient:.1}}]};return e}var i=r(1),u=(n(i),r(4)),o=n(u),l=document.getElementById("canvas"),c=320,s=240;l.width=c,l.height=s,l.style.cssText="width:"+2*c+"px;height:"+2*s+"px";var d=new o.default(l,a,{enableSampling:!1});d.tick(),document.getElementById("play").onclick=d.play.bind(d),document.getElementById("stop").onclick=d.stop.bind(d)},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=r(5),i=n(a);e.default=i.default},function(t,e,r){"use strict";function n(t,e){if(!t.type)throw new Error("Object has no type.");switch(t.type){case"sphere":return(0,i.sphereIntersection)(t,e);default:throw new Error("Invalid object type.")}}function a(t,e){if(!t.type)throw new Error("Object has no type.");switch(t.type){case"sphere":return(0,i.sphereNormal)(t,e);default:throw new Error("Invalid object type.")}}Object.defineProperty(e,"__esModule",{value:!0}),e.calculateNormal=e.calculateIntersection=void 0;var i=r(3);e.calculateIntersection=n,e.calculateNormal=a},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t,e){var r=o.default.sub(t.center,e.origin),n=o.default.dot(r,e.direction),a=o.default.dot(r,r),i=t.radius*t.radius-a+n*n;if(!(i<0))return n-Math.sqrt(i)}function i(t,e){return o.default.normalize(o.default.sub(e,t.center))}Object.defineProperty(e,"__esModule",{value:!0}),e.sphereNormal=e.sphereIntersection=void 0;var u=r(1),o=n(u);e.sphereIntersection=a,e.sphereNormal=i},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){var r=[],n=!0,a=!1,i=void 0;try{for(var u,o=t[Symbol.iterator]();!(n=(u=o.next()).done)&&(r.push(u.value),!e||r.length!==e);n=!0);}catch(t){a=!0,i=t}finally{try{!n&&o.return&&o.return()}finally{if(a)throw i}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(1),l=n(o),c=r(2),s=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.traceDepthLimit,u=void 0===i?3:i,o=n.enableSampling,l=void 0!==o&&o,c=n.numSamples,s=void 0===c?9:c;a(this,t);var d=e.width,f=e.height;this.canvas=e,this.context=e.getContext("2d"),this.data=this.context.getImageData(0,0,d,f),this.generateScene=r,this.traceDepthLimit=u,this.enableSampling=l,this.numSamples=s,this.isPlaying=!1,this.time=1}return u(t,[{key:"render",value:function(t){for(var e=t.camera,r=this.canvas,n=r.width,a=r.height,i=this.data,u=l.default.normalize(l.default.sub(e.direction,e.point)),o=l.default.normalize(l.default.cross(u,l.default.UP)),c=l.default.normalize(l.default.cross(o,u)),s=Math.PI*(e.fieldOfView/2)/180,d=a/n,f=Math.tan(s),h=d*f,y=2*f,m=2*h,v=y/(n-1),p=m/(a-1),x={origin:e.point,direction:l.default.new()},z=0;z<n;z++)for(var g=0;g<a;g++){var b=l.default.copy(l.default.ZERO);if(this.enableSampling){for(var M=Math.sqrt(this.numSamples),w=0;w<M;w++)for(var _=0;_<M;_++){var I=v*(z-f+(_+Math.random())/M)-f,S=p*(g-h+(w+Math.random())/M)-h,k=l.default.mult(o,I),E=l.default.mult(c,S);x.direction=l.default.normalize(l.default.add3(k,E,u)),b=l.default.add(b,this.trace(x,t,0))}b=l.default.div(b,this.numSamples)}else{var O=v*(z-f)-f,P=p*(g-h)-h,j=l.default.mult(o,O),T=l.default.mult(c,P);x.direction=l.default.normalize(l.default.add3(j,T,u)),b=this.trace(x,t,0)}var q=4*z+g*n*4;i.data[q+0]=b.x,i.data[q+1]=b.y,i.data[q+2]=b.z,i.data[q+3]=255}this.context.putImageData(i,0,0)}},{key:"trace",value:function(t,e,r){if(!(r>this.traceDepthLimit)){var n=this.intersectScene(t,e),a=i(n,2),u=a[0],o=a[1];if(u===1/0)return l.default.copy(l.default.WHITE);var s=l.default.add(l.default.mult(t.direction,u),t.origin);return this.surface(t,e,o,s,(0,c.calculateNormal)(o,s),r)}}},{key:"intersectScene",value:function(t,e){return e.objects.reduce(function(e,r){var n=(0,c.calculateIntersection)(r,t);return void 0!==n&&n<e[0]?[n,r]:e},[1/0,null])}},{key:"surface",value:function(t,e,r,n,a,i){var u=l.default.copy(l.default.ZERO),o=0;if(r.material.lambert)for(var c=0;c<e.lights.length;c++){var s=e.lights[c];if(this.isLightVisible(n,e,s)){var d=l.default.dot(l.default.normalize(l.default.sub(s,n)),a);d>0&&(o+=d)}}if(r.material.specular){var f={origin:n,direction:l.default.reflectThrough(t.direction,a)},h=this.trace(f,e,i+1);h&&(u=l.default.add(u,l.default.mult(h,r.material.specular)))}return o=Math.min(1,o),u=l.default.add(u,l.default.mult(r.color,o*r.material.lambert)),u=l.default.add(u,l.default.mult(r.color,r.material.ambient))}},{key:"isLightVisible",value:function(t,e,r){var n={origin:t,direction:l.default.normalize(l.default.sub(t,r))},a=this.intersectScene(n,e),u=i(a,1),o=u[0];return o>-.005}},{key:"tick",value:function(){var t=this.generateScene(this.time);this.time++,this.render(t),this.isPlaying&&requestAnimationFrame(this.tick.bind(this))}},{key:"play",value:function(){this.isPlaying||(this.isPlaying=!0,requestAnimationFrame(this.tick.bind(this)))}},{key:"stop",value:function(){this.isPlaying=!1}}]),t}();e.default=s},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={};r.UP={x:0,y:1,z:0},r.ZERO={x:0,y:0,z:0},r.WHITE={x:255,y:255,z:255},r.new=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{x:t,y:e,z:r}},r.copy=function(t){return{x:t.x,y:t.y,z:t.z}},r.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},r.cross=function(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}},r.mult=function(t,e){return{x:t.x*e,y:t.y*e,z:t.z*e}},r.div=function(t,e){return{x:t.x/e,y:t.y/e,z:t.z/e}},r.normalize=function(t){var e=r.mag(t);return 0===e?t:r.div(t,e)},r.add=function(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}},r.add3=function(t,e,r){return{x:t.x+e.x+r.x,y:t.y+e.y+r.y,z:t.z+e.z+r.z}},r.sub=function(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}},r.mag=function(t){return Math.sqrt(r.dot(t,t))},r.angleBetween=function(t,e){return Math.acos(r.dot(t,e)/(r.mag(t)*r.mag(e)))},r.reflectThrough=function(t,e){var n=r.mult(e,r.dot(t,e));return r.sub(r.mult(n,2),t)},r.dist=function(t,e){var n=r.sub(e,t);return r.mag(n)},r.equal=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z},r.lerp=function(t,e,r){return{x:t.x+(e.x-t.x)*r||0,y:t.y+(e.y-t.y)*r||0,z:t.z+(e.z-t.z)*r||0}},r.setMag=function(t,e){return r.mult(r.normalize(t),e)},r.limit=function(t,e){var n=r.dot(t,t);return n>e*e?r.setMag(t,e):t},r.heading=function(t){return Math.atan2(t.y,t.x)},r.rotate=function(t,e){var n=r.heading(t)+e,a=r.mag(t);return{x:Math.cos(n)*a,y:Math.sin(n)*a,z:t.z}},r.toString=function(t){return"["+t.x+", "+t.y+", "+t.z+"]"},r.toArray=function(t){return[t.x,t.y,t.z]},e.default=r}]);
//# sourceMappingURL=bundle.js.map